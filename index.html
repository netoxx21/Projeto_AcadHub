<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Biblioteca - AcadHub</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="frontend/style.css" rel="stylesheet">
</head>
<body>
    
 <nav class="navbar navbar-expand-lg bg-primary" data-bs-theme="dark">
  <div class="container-fluid">

    <a class="navbar-brand" href="#">AcadHub</a>


    <div class="collapse navbar-collapse" id="acadhubNavbar">

      <ul class="navbar-nav me-auto mb-2 mb-lg-0">

        <li class="nav-item">
          <a class="nav-link" href="index.html">Inicio</a>
        </li>

        <li class="nav-item">
          <a class="nav-link" href="upload.html">Upload de resumos</a>
        </li>

        </li>

      </ul>

     <ul class="navbar-nav">
        <li class="nav-item">
            <!-- adicionei id para interceptar o clique e pedir confirmação -->
            <a id="logout-link" class="nav-link text-danger" href="login.html">sair</a>
        </li>
      </ul>

    </div>
  </div>
</nav>

  <main class="container py-4">
    <h1 class="mb-3">Biblioteca de Resumos</h1>

    <div class="mb-3 d-flex" style="max-width: 600px;">
      <input id="search" class="form-control me-2" placeholder="Pesquisar título, descrição ou curso..." />
      <button title="Enviar novo resumo" id="btn-upload" class="btn fw-bold" style="background-color: #2a79ef; border-color: #0d6efd;">+</button>
    </div>


    <div id="lista-resumos" class="list-group">
      <!-- resumos serão inseridos aqui -->
    </div>
  </main>

<script>
  // busca resumos do backend e renderiza na página
  async function fetchResumos() {
    try {
      const res = await fetch('http://localhost:4000/api/resumos');
      if (!res.ok) throw new Error('Falha ao carregar resumos: ' + res.status);
      const data = await res.json();
      renderResumos(data);
    } catch (err) {
      console.error(err);
      document.getElementById('lista-resumos').innerHTML = '<div class="text-danger">Não foi possível carregar os resumos.</div>';
    }
  }

  // cria itens na lista
  function renderResumos(items) {
    const container = document.getElementById('lista-resumos');
    if (!items || items.length === 0) {
      container.innerHTML = '<div class="text-muted">Nenhum resumo disponível.</div>';
      return;
    }
    container.innerHTML = items.map(i => `
      <div class="list-group-item">
        <div class="d-flex w-100 justify-content-between">
          <h5 class="mb-1">${escapeHtml(i.titulo)}</h5>
          <small class="text-muted">${new Date(i.created_at).toLocaleString()}</small>
        </div>
        <p class="mb-1">${escapeHtml(i.descricao || '')}</p>
        <small class="text-muted">Curso: ${escapeHtml(i.curso || '-')}${i.uploader ? ' • Enviado por: ' + escapeHtml(i.uploader) : ''}</small>
        <div class="mt-2">
          ${i.url ? `<a class="btn btn-sm btn-outline-primary" href="${i.url}" target="_blank" rel="noopener">Baixar / Ver</a>` : ''}
        </div>
      </div>
    `).join('');
  }

  // Busca e filtra localmente
  document.getElementById('search').addEventListener('input', (e) => {
    const q = e.target.value.toLowerCase();
    const items = Array.from(document.querySelectorAll('#lista-resumos .list-group-item'));
    items.forEach(it => {
      const text = it.textContent.toLowerCase();
      it.style.display = text.includes(q) ? '' : 'none';
    });
  });

  // evita injeção simples
  function escapeHtml(str) {
    return String(str || '').replace(/[&<>"']/g, s => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[s]));
  }

    (function() {
    const logout = document.getElementById('logout-link');
    if (!logout) return;
    logout.addEventListener('click', (e) => {
      e.preventDefault();
      const ok = confirm('Deseja realmente sair?');
      if (ok) {
        // remove o token (se houver) e redireciona para a tela de login
        try { localStorage.removeItem('token'); } catch (err) { /* noop */ }
        window.location.href = 'login.html';
      }
    });
  })();

  // inicializa
  fetchResumos();

  const btnUpload = document.getElementById('btn-upload');
    if (btnUpload) {
      btnUpload.addEventListener('click', function() {
       window.location.href = 'upload.html';
      });
}
</script>
</body>
</html>